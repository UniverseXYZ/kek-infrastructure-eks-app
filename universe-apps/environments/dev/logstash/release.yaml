apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: logstash
spec:
  releaseName: logstash
  targetNamespace: dev
  interval: 5m
  chart:
    spec:
      chart: logstash
      version: 3.6.20
      sourceRef:
        kind: HelmRepository
        name: bitnami
        namespace: dev
  values:
    image:
      repository: opensearchproject/logstash-oss-with-opensearch-output-plugin
      tag: 7.16.1
      debug: true
    initContainers: 
    - name: install-plugins
      image: opensearchproject/logstash-oss-with-opensearch-output-plugin:7.16.1
      command: ['sh', '-c', "/usr/share/bin/logstash-plugin install logstash-input-jdbc"]

    extraEnvVars: []
    persistence:
      enabled: true
      storageClass: ebs-sc
      size: 8Gi
    input: ""
    filter: ""
    output: |-
      opensearch {
        hosts => ["https://vpc-universe-dev-rctynsnc4sybvk4uxetqyhwk3a.us-east-1.es.amazonaws.com:443"]
        index => "postgres-%{+YYYY.MM.dd}"
        user => "kekdao"
        password => "Universe!!!420"
      }
